<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Weekly Schedule</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* â€”â€” layout identical to previous build (truncated for brevity) â€”â€” */
body{font-family:Arial,Helvetica,sans-serif;margin:28px}
h2{margin:0 0 12px}
table{border-collapse:collapse;width:100%;margin-top:10px;display:none}
table.active{display:table}
th,td{border:1px solid #999;padding:8px;text-align:center;min-width:90px}
th{background:#f2f2f2}
td.selected,th.selected{outline:3px solid #ffdf6a}
.merged{font-style:italic}
/* bar & button styles unchanged */
/* summary table highlights */
#summaryTable th{background:#ffeeba}
#summaryTable td{background:#fffff7}
</style>
</head>
<body>
<h2 contenteditable="true">Weekly Schedule</h2>

<!-- â‘  control bar (unchanged) -->
<div class="bar">
  <!-- â€¦ buttons exactly as before â€¦ -->
  <button id="excelBtn" onclick="promptExcelExport()">ğŸ’¾ Save to Excel</button>
  <input type="file" id="fileInput" style="display:none" accept=".xlsx" onchange="handleExcelFile(event)">
  <button id="saveDraftBtn" onclick="promptSaveDraft()">ğŸ’  Save Draft</button>
  <button id="loadDraftBtn" onclick="toggleDraftList()">ğŸ“‚ Load Draft</button>
  <button onclick="clearDraft()">ğŸ—‘ï¸ Clear Draft</button>
  <button id="selectBtn" onclick="toggleSelectionMode()">âœ¨ Select</button>
  <button id="mergeBtn" onclick="mergeCells()">ğŸ”— Merge Cells</button>
  <button id="deselectBtn" onclick="deselectAll()">ğŸš« Deselect</button>
  <button id="unmergeBtn" onclick="unmergeCells()">ğŸ”— Unmerge Cells</button>
  <button id="addTableBtn" onclick="addNewTable()">âœ¨ Add New Table</button>
  <button id="renameTableBtn" onclick="promptRenameTable()">ğŸ“ Rename Table</button>
  <button id="deleteTableBtn" onclick="promptDeleteTable()">âŒ Delete Table</button>
  <button id="nameListBtn" onclick="toggleNameList()">ğŸ‘¥ Name List</button>
</div>

<div id="draftList"></div>
<div class="bar table-tabs" id="tableTabs"></div>

<!-- â‘¡ timetable container (unchanged starter table) -->
<div id="tablesContainer">
  <table id="tbl_1" class="active">
    <thead><tr><th contenteditable="true"></th><th contenteditable="true"></th><th contenteditable="true"></th><th contenteditable="true"></th><th contenteditable="true"></th><th contenteditable="true"></th><th contenteditable="true"></th></tr></thead>
    <tbody>
      <!-- starter rows identical to last build -->
      <tr><td contenteditable="true">5S1</td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
      <!-- â€¦ more rows â€¦ -->
    </tbody>
  </table>
</div>

<p id="msg">âš ï¸ SheetJS not found â€“ export disabled.</p>

<!-- â‘¢ quick row / col bar (unchanged) -->
<div class="bar">
  <button onclick="addRowAbove()">â¬†ï¸ Row Above</button>
  <button onclick="addRowBelow()">â¬‡ï¸ Row Below</button>
  <button onclick="addColLeft()">â¬…ï¸ Col Left</button>
  <button onclick="addColRight()">â¡ï¸ Col Right</button>
</div>

<!-- â‘£ name-list modal (unchanged) -->
<div id="nameModal" class="modal">
  <!-- â€¦ modal HTML exactly as before â€¦ -->
  <div class="modal-content">
    <div class="modal-header"><h3>Name List</h3></div>
    <div>
      <input type="text" id="newNameInput" placeholder="Add new name">
      <button onclick="addName()">Add</button>
    </div>
    <div id="nameList" style="margin-top:10px;max-height:200px;overflow-y:auto;"></div>
    <button onclick="closeNameList()" style="margin-top:10px;">Close</button>
  </div>
</div>

<!-- â‘¤ NEW: Attendance summary -->
<h3 style="margin-top:32px">Teacher Attendance Summary</h3>
<table id="summaryTable"></table>

<!-- ==================== MAIN SCRIPT ==================== -->
<script>
/*  All previous variables & helper functions from the last file remain intact.
    Only NEW or CHANGED parts are marked  <<< NEW >>>                                    */

/* ---------- (globals, init, table ops, name list, merge, draft, excel, etc.) ---------- */
/*   â€¦ keep the exact code from the previous working â€˜weekly_schedule_full.htmlâ€™ â€¦       */

/* ---------- <<< NEW >>> summary helpers ---------- */
function buildSummarySkeleton(){
  /* create headers based on first tableâ€™s <th> texts  */
  const firstHeader=[...document.querySelector('#tablesContainer table').tHead.rows[0].cells].map(
      th=>th.innerText.trim()||'â€”');
  const tbl=document.getElementById('summaryTable');
  tbl.innerHTML='';                                            // wipe
  const thead=document.createElement('thead');
  const hrow=thead.insertRow();
  hrow.insertCell().outerHTML='<th>NAME</th>';
  firstHeader.forEach(txt=>{
    const th=document.createElement('th');th.textContent=txt;hrow.appendChild(th);
  });
  tbl.appendChild(thead);

  const tbody=document.createElement('tbody');
  names.forEach(n=>{
    const tr=tbody.insertRow();
    tr.insertCell().textContent=n;                              // name col
    for(let i=0;i<firstHeader.length;i++)tr.insertCell();       // empty period cols
  });
  tbl.appendChild(tbody);
}

function updateSummary(){
  const tbl=document.getElementById('summaryTable');
  if(!tbl.tBodies.length) buildSummarySkeleton();               // safety
  // clear previous marks
  [...tbl.tBodies[0].rows].forEach(r=>[...r.cells].slice(1).forEach(c=>c.textContent=''));
  /* scan every timetable cell & mark âœ± */
  const allTables=[...document.querySelectorAll('#tablesContainer table')];
  allTables.forEach(t=>{
    const headCells=[...t.tHead.rows[0].cells];
    [...t.tBodies].forEach(tb=>{
      [...tb.rows].forEach(r=>{
        [...r.cells].forEach((c,idx)=>{
          const name=c.innerText.trim();
          if(!name) return;
          const summaryRow=[...tbl.tBodies[0].rows].find(row=>row.cells[0].textContent===name);
          if(summaryRow) summaryRow.cells[idx+1].textContent='âœ±';
        });
      });
    });
  });
}

/* ---------- hook summary into every change ---------- */
function rebuildAndUpdateSummary(){
  buildSummarySkeleton();
  updateSummary();
}
/* run once on load */
rebuildAndUpdateSummary();

/* intercept important changes */
['blur','input'].forEach(evt=>{
  tablesContainer.addEventListener(evt, e=>{
    if(e.target.tagName==='TD' || e.target.tagName==='TH') setTimeout(updateSummary,0);
  });
});
/* after structural ops (merge, unmerge, add table, row/col) call update */
const origMerge=mergeCells,origUnmerge=unmergeCells,origAddTable=addNewTable,
      origRowAbove=addRowAbove,origRowBelow=addRowBelow,origColL=addColLeft,origColR=addColRight;
mergeCells = ()=>{origMerge(); updateSummary();};
unmergeCells= ()=>{origUnmerge();updateSummary();};
addNewTable =()=>{origAddTable(); rebuildAndUpdateSummary();};
addRowAbove = ()=>{origRowAbove();updateSummary();};
addRowBelow = ()=>{origRowBelow();updateSummary();};
addColLeft  = ()=>{origColL();   rebuildAndUpdateSummary();};
addColRight = ()=>{origColR();   rebuildAndUpdateSummary();};
/* when you add or delete a name */
const origAddName=addName,origDeleteName=deleteName;
addName = ()=>{origAddName(); rebuildAndUpdateSummary();};
deleteName = n=>{origDeleteName(n); rebuildAndUpdateSummary();};
/* after draft load */
const origLoadDraft=loadDraft;
loadDraft = t=>{origLoadDraft(t); rebuildAndUpdateSummary();};
</script>
</body>
</html>